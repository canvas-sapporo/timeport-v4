# 本番環境デプロイ前チェックリスト

## 環境変数の確認

### Vercel環境変数

- [ ] `NEXT_PUBLIC_SUPABASE_URL` が設定されている
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` が設定されている
- [ ] `SUPABASE_SERVICE_ROLE_KEY` が設定されている
- [ ] `NEXT_PUBLIC_USE_SUPABASE` が `true` に設定されている

### 環境変数の値確認

- [ ] Supabase URLが正しい（本番プロジェクトのURL）
- [ ] Anon Keyが正しい
- [ ] Service Role Keyが正しい

## Supabase設定の確認

### Auth設定

- [ ] Site URLに本番ドメインが設定されている
- [ ] Redirect URLsに本番ドメインが含まれている
- [ ] Email confirmationsの設定が適切

### データベース設定

- [ ] マイグレーションが実行されている
- [ ] 必要なテーブルが作成されている
- [ ] RLSポリシーが設定されている

### RLSポリシー確認

- [ ] `user_profiles` テーブルのポリシー
- [ ] `attendances` テーブルのポリシー
- [ ] `work_types` テーブルのポリシー
- [ ] その他必要なテーブルのポリシー

## アプリケーション設定の確認

### next.config.js

- [ ] Server ActionsのallowedOriginsに本番ドメインが含まれている
- [ ] その他の設定が適切

### ビルド設定

- [ ] `pnpm build` が成功する
- [ ] TypeScriptエラーがない
- [ ] ESLintエラーがない

## 機能テスト

### 認証機能

- [ ] ログインが正常に動作する
- [ ] ログアウトが正常に動作する
- [ ] セッション管理が正常に動作する

### 打刻機能

- [ ] 出勤打刻が正常に動作する
- [ ] 退勤打刻が正常に動作する
- [ ] 休憩開始・終了が正常に動作する
- [ ] 勤怠データの取得が正常に動作する

### 管理者機能

- [ ] ユーザー管理が正常に動作する
- [ ] 勤怠管理が正常に動作する
- [ ] 設定管理が正常に動作する

## デバッグ機能の確認

### デバッグページ

- [ ] `/debug` ページが正常に表示される
- [ ] 環境変数の表示が正しい
- [ ] Server Actionsテストが正常に動作する

### ログ出力

- [ ] ブラウザコンソールでエラーが発生していない
- [ ] Vercel関数ログでエラーが発生していない

## セキュリティ確認

### 環境変数の漏洩

- [ ] 機密情報がクライアントサイドに露出していない
- [ ] Service Role Keyが適切に保護されている

### アクセス制御

- [ ] 未認証ユーザーが保護されたページにアクセスできない
- [ ] 権限のないユーザーが管理者機能にアクセスできない

## パフォーマンス確認

### 読み込み速度

- [ ] 初回読み込みが適切な時間で完了する
- [ ] ページ遷移がスムーズに動作する

### データベース接続

- [ ] Supabase接続が安定している
- [ ] クエリの実行時間が適切

## デプロイ後の確認

### 本番環境での動作確認

- [ ] 本番URLでアプリケーションが正常に動作する
- [ ] すべての機能が正常に動作する
- [ ] エラーページが適切に表示される

### 監視設定

- [ ] Vercelの監視が有効になっている
- [ ] エラー通知が設定されている

## 緊急時の対応準備

### ロールバック手順

- [ ] 前のバージョンへのロールバック手順が準備されている
- [ ] データベースのバックアップが取得されている

### 連絡先

- [ ] 問題発生時の連絡先が明確になっている
- [ ] サポート体制が整備されている

## チェックリストの使用方法

1. デプロイ前に各項目をチェック
2. 問題がある場合は修正してからデプロイ
3. デプロイ後も動作確認を実施
4. 定期的にチェックリストを見直し

## 注意事項

- 本番環境での変更は慎重に行う
- 変更前には必ずバックアップを取得
- 問題が発生した場合は即座にロールバックを検討
- ユーザーへの影響を最小限に抑える
